{{- if .Values.autoscaling.keda.enabled }}
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: {{ include "id-generator.fullname" . }}
  labels:
    {{- include "id-generator.labels" . | nindent 4 }}
spec:
  scaleTargetRef:
    name: {{ include "id-generator.fullname" . }}
  minReplicaCount: {{ .Values.autoscaling.minReplicas }}
  maxReplicaCount: {{ .Values.autoscaling.maxReplicas }}
  triggers:
  - type: prometheus
    metadata:
      serverAddress: {{ .Values.autoscaling.keda.prometheusServerAddress }}
      metricName: id_generator_sequence_exhausted_total
      query: |
        rate(id_generator_sequence_exhausted_total[1m])
      threshold: {{ .Values.autoscaling.keda.threshold | quote }}
{{- end }}
